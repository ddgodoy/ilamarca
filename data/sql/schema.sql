CREATE TABLE app_user (id INT AUTO_INCREMENT, name VARCHAR(100), last_name VARCHAR(100), email VARCHAR(200) NOT NULL, photo VARCHAR(50), salt VARCHAR(100), password VARCHAR(100), recover_token VARCHAR(100), enabled TINYINT(1) DEFAULT '1', last_access datetime, company_id INT NOT NULL, user_role_id INT NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX company_id_idx (company_id), INDEX user_role_id_idx (user_role_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE bedroom (id INT AUTO_INCREMENT, name VARCHAR(50) NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE city (id INT AUTO_INCREMENT, name VARCHAR(100) NOT NULL, geo_zone_id INT NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX geo_zone_id_idx (geo_zone_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE company (id INT AUTO_INCREMENT, name VARCHAR(50) NOT NULL, email VARCHAR(200), address VARCHAR(100), phone VARCHAR(50), logo VARCHAR(50), created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE country (id INT AUTO_INCREMENT, name VARCHAR(100) NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE currency (id INT AUTO_INCREMENT, name VARCHAR(50) NOT NULL, iso_code VARCHAR(5), culture VARCHAR(5), symbol VARCHAR(5), created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE gallery (id INT AUTO_INCREMENT, former_name VARCHAR(150), internal_name VARCHAR(50), outstanding TINYINT(1) DEFAULT '0', real_property_id INT NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX real_property_id_idx (real_property_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE geo_zone (id INT AUTO_INCREMENT, name VARCHAR(100) NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE neighborhood (id INT AUTO_INCREMENT, name VARCHAR(100) NOT NULL, city_id INT NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX city_id_idx (city_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE operation (id INT AUTO_INCREMENT, name VARCHAR(50) NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE operation_real_property (operation_id INT, real_property_id INT, price DECIMAL(10, 2) DEFAULT 0, currency_id INT NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX currency_id_idx (currency_id), PRIMARY KEY(operation_id, real_property_id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE property_type (id INT AUTO_INCREMENT, name VARCHAR(100) NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE real_property_translation (id INT, name VARCHAR(250), detail text, address text, points_of_ref text, transports text, lang CHAR(2), PRIMARY KEY(id, lang)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE real_property (id INT AUTO_INCREMENT, google_map text, pdf_file VARCHAR(50), qr_code VARCHAR(50), square_meters INT DEFAULT 0, covered_area INT DEFAULT 0, years_antiquity INT DEFAULT 0, qty_bathrooms INT DEFAULT 1, has_garage TINYINT(1) DEFAULT '0', has_swimming_pool TINYINT(1) DEFAULT '0', has_dep_of_service TINYINT(1) DEFAULT '0', has_balcony TINYINT(1) DEFAULT '0', has_bbq TINYINT(1) DEFAULT '0', owner_name VARCHAR(100), owner_phone VARCHAR(50), owner_email VARCHAR(250), bedroom_id INT NOT NULL, property_type_id INT NOT NULL, geo_zone_id INT NOT NULL, city_id INT NOT NULL, neighborhood_id INT NOT NULL, app_user_id INT NOT NULL, updated datetime, INDEX bedroom_id_idx (bedroom_id), INDEX property_type_id_idx (property_type_id), INDEX geo_zone_id_idx (geo_zone_id), INDEX city_id_idx (city_id), INDEX neighborhood_id_idx (neighborhood_id), INDEX app_user_id_idx (app_user_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE search_match (search_profile_id INT, real_property_id INT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(search_profile_id, real_property_id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE search_profile (id INT AUTO_INCREMENT, property_type_id INT, operation_id INT, geo_zone_id INT, city_id INT, neighborhood_id INT, app_user_id INT, min_price DECIMAL(10, 2) DEFAULT 0, max_price DECIMAL(10, 2) DEFAULT 0, currency_id INT, is_vendor TINYINT(1) DEFAULT '0', reference VARCHAR(150), created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX property_type_id_idx (property_type_id), INDEX operation_id_idx (operation_id), INDEX geo_zone_id_idx (geo_zone_id), INDEX city_id_idx (city_id), INDEX neighborhood_id_idx (neighborhood_id), INDEX app_user_id_idx (app_user_id), INDEX currency_id_idx (currency_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE user_role (id INT AUTO_INCREMENT, name VARCHAR(50) NOT NULL, credentials VARCHAR(250), code VARCHAR(50), created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE vendor_zone (id INT AUTO_INCREMENT, app_user_id INT, neighborhood_id INT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX app_user_id_idx (app_user_id), INDEX neighborhood_id_idx (neighborhood_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE video (id INT AUTO_INCREMENT, youtube text, uploaded VARCHAR(50), real_property_id INT NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX real_property_id_idx (real_property_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
ALTER TABLE app_user ADD CONSTRAINT app_user_user_role_id_user_role_id FOREIGN KEY (user_role_id) REFERENCES user_role(id) ON DELETE CASCADE;
ALTER TABLE app_user ADD CONSTRAINT app_user_company_id_company_id FOREIGN KEY (company_id) REFERENCES company(id) ON DELETE CASCADE;
ALTER TABLE city ADD CONSTRAINT city_geo_zone_id_geo_zone_id FOREIGN KEY (geo_zone_id) REFERENCES geo_zone(id) ON DELETE CASCADE;
ALTER TABLE gallery ADD CONSTRAINT gallery_real_property_id_real_property_id FOREIGN KEY (real_property_id) REFERENCES real_property(id) ON DELETE CASCADE;
ALTER TABLE neighborhood ADD CONSTRAINT neighborhood_city_id_city_id FOREIGN KEY (city_id) REFERENCES city(id) ON DELETE CASCADE;
ALTER TABLE operation_real_property ADD CONSTRAINT operation_real_property_real_property_id_real_property_id FOREIGN KEY (real_property_id) REFERENCES real_property(id) ON DELETE CASCADE;
ALTER TABLE operation_real_property ADD CONSTRAINT operation_real_property_operation_id_operation_id FOREIGN KEY (operation_id) REFERENCES operation(id) ON DELETE CASCADE;
ALTER TABLE operation_real_property ADD CONSTRAINT operation_real_property_currency_id_currency_id FOREIGN KEY (currency_id) REFERENCES currency(id) ON DELETE CASCADE;
ALTER TABLE real_property_translation ADD CONSTRAINT real_property_translation_id_real_property_id FOREIGN KEY (id) REFERENCES real_property(id) ON UPDATE CASCADE ON DELETE CASCADE;
ALTER TABLE real_property ADD CONSTRAINT real_property_property_type_id_property_type_id FOREIGN KEY (property_type_id) REFERENCES property_type(id) ON DELETE CASCADE;
ALTER TABLE real_property ADD CONSTRAINT real_property_neighborhood_id_neighborhood_id FOREIGN KEY (neighborhood_id) REFERENCES neighborhood(id) ON DELETE CASCADE;
ALTER TABLE real_property ADD CONSTRAINT real_property_geo_zone_id_geo_zone_id FOREIGN KEY (geo_zone_id) REFERENCES geo_zone(id) ON DELETE CASCADE;
ALTER TABLE real_property ADD CONSTRAINT real_property_city_id_city_id FOREIGN KEY (city_id) REFERENCES city(id) ON DELETE CASCADE;
ALTER TABLE real_property ADD CONSTRAINT real_property_bedroom_id_bedroom_id FOREIGN KEY (bedroom_id) REFERENCES bedroom(id) ON DELETE CASCADE;
ALTER TABLE real_property ADD CONSTRAINT real_property_app_user_id_app_user_id FOREIGN KEY (app_user_id) REFERENCES app_user(id) ON DELETE CASCADE;
ALTER TABLE search_match ADD CONSTRAINT search_match_search_profile_id_search_profile_id FOREIGN KEY (search_profile_id) REFERENCES search_profile(id) ON DELETE CASCADE;
ALTER TABLE search_match ADD CONSTRAINT search_match_real_property_id_real_property_id FOREIGN KEY (real_property_id) REFERENCES real_property(id) ON DELETE CASCADE;
ALTER TABLE search_profile ADD CONSTRAINT search_profile_property_type_id_property_type_id FOREIGN KEY (property_type_id) REFERENCES property_type(id) ON DELETE SET NULL;
ALTER TABLE search_profile ADD CONSTRAINT search_profile_operation_id_operation_id FOREIGN KEY (operation_id) REFERENCES operation(id) ON DELETE SET NULL;
ALTER TABLE search_profile ADD CONSTRAINT search_profile_neighborhood_id_neighborhood_id FOREIGN KEY (neighborhood_id) REFERENCES neighborhood(id) ON DELETE SET NULL;
ALTER TABLE search_profile ADD CONSTRAINT search_profile_geo_zone_id_geo_zone_id FOREIGN KEY (geo_zone_id) REFERENCES geo_zone(id) ON DELETE SET NULL;
ALTER TABLE search_profile ADD CONSTRAINT search_profile_currency_id_currency_id FOREIGN KEY (currency_id) REFERENCES currency(id) ON DELETE SET NULL;
ALTER TABLE search_profile ADD CONSTRAINT search_profile_city_id_city_id FOREIGN KEY (city_id) REFERENCES city(id) ON DELETE SET NULL;
ALTER TABLE search_profile ADD CONSTRAINT search_profile_app_user_id_app_user_id FOREIGN KEY (app_user_id) REFERENCES app_user(id) ON DELETE SET NULL;
ALTER TABLE vendor_zone ADD CONSTRAINT vendor_zone_neighborhood_id_neighborhood_id FOREIGN KEY (neighborhood_id) REFERENCES neighborhood(id) ON DELETE CASCADE;
ALTER TABLE vendor_zone ADD CONSTRAINT vendor_zone_app_user_id_app_user_id FOREIGN KEY (app_user_id) REFERENCES app_user(id) ON DELETE CASCADE;
ALTER TABLE video ADD CONSTRAINT video_real_property_id_real_property_id FOREIGN KEY (real_property_id) REFERENCES real_property(id) ON DELETE CASCADE;
